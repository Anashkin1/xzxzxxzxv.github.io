import{h as V,s as C,_ as P,A as b,r as n,o as d,c as v,w as r,b as s,d as l,e as O,f as D,F,g as i,t as a,i as u,j as H,k as B,p as K,l as Y}from"./index-9fec22f0.js";const R={Api(){return V.create({baseURL:C.getters.crmUrl+"/rest/"+C.getters.crmKey,withCredentials:!1,headers:{Accept:"application/json","Content-Type":"application/json"}})},getUsers(o){return this.Api().get("user.get",{params:{ID:o}})},searchUser(o){return this.Api().get("user.get",{params:{ORDER:{LAST_NAME:"ASC"},FILTER:{NAME_SEARCH:o,USER_TYPE:"employee",ACTIVE:!0}}})}};const j={name:"OperatorView",data(){return{operators:[],crmUsers:[],usersList:[],selectedOperator:null,searchUser:null}},methods:{searchCrm(o){this.searchUser&&R.searchUser(this.searchUser).then(t=>{this.usersList=t.data.result,console.log(t.data.result)})},getUsers(o){const t=o.map(c=>c.crm_user_id);t.length&&R.getUsers(t).then(c=>this.crmUsers=c.data.result)},getFullName(o){const t=this.crmUsers.find(p=>parseInt(p.ID)===o);if(!t)return;let c="";return t.LAST_NAME&&(c+=t.LAST_NAME),t.NAME&&(c+=" "+t.NAME),t.SECOND_NAME&&(c+=" "+t.SECOND_NAME),c},saveOperator(){const o=parseInt(this.selectedOperator.ID),t=this.selectedOperator.UF_PHONE_INNER;if(!t)return this.$notify({title:"Номер пуст",type:"error"}),this.selectedOperator=null,!1;if([...this.operators].find(p=>p.crm_user_id===o))return this.selectedOperator=null,this.$notify({title:"Сотрудник уже подключен",type:"warn"}),!1;b.operatorAdd(o,t).then(p=>(this.selectedOperator=null,this.getOperators(),this.$notify({title:"Добавлен новый сотрудник",type:"success"}),!0))},getOperators(){b.operatorGetList().then(o=>{let t=o.data.data;this.getUsers(t),t.forEach(c=>c.delete=!1),this.operators=t})},deleteOperators(){[...this.operators].filter(o=>o.delete)}},mounted(){this.getOperators()}},f=o=>(K("data-v-c3a515c0"),o=o(),Y(),o),W={class:"text-left th-border-right",style:{width:"80px"}},G=f(()=>l("th",{class:"text-center th-border-right",style:{width:"80px"}}," № ",-1)),q=f(()=>l("th",{class:"text-left th-border-right"}," ФИО ",-1)),z=f(()=>l("th",{class:"text-left"}," Внутр. телефон ",-1)),J={class:"th-border-right"},Q={class:"th-border-right text-center"},X={class:"th-border-right"},Z=f(()=>l("td",{class:"th-border-right text-center"},null,-1)),$=f(()=>l("td",{class:"th-border-right text-center"},null,-1)),ee={class:"th-border-right pa-3"},te={key:0},re={key:1};function se(o,t,c,p,_,m){const A=n("v-checkbox"),S=n("v-text-field"),U=n("v-list-item"),T=n("v-divider"),x=n("v-spacer"),h=n("v-chip"),N=n("v-row"),k=n("v-list-item-title"),w=n("v-list-item-content"),L=n("v-select"),I=n("v-btn"),M=n("v-table"),E=n("v-col"),y=n("v-container");return d(),v(y,null,{default:r(()=>[s(N,null,{default:r(()=>[s(E,{cols:"12"},{default:r(()=>[s(M,{density:"compact"},{default:r(()=>[l("thead",null,[l("tr",null,[l("th",W,[s(A,{"model-value":!1,"hide-details":!0})]),G,q,z])]),l("tbody",null,[(d(!0),O(F,null,D(_.operators,e=>(d(),O("tr",{key:e.id},[l("td",J,[s(A,{"hide-details":!0,"model-value":e.delete,modelValue:e.delete,"onUpdate:modelValue":g=>e.delete=g},null,8,["model-value","modelValue","onUpdate:modelValue"])]),l("td",Q,a(e.id),1),l("td",X,a(m.getFullName(e.crm_user_id)),1),l("td",null,a(e.phone),1)]))),128)),l("tr",null,[Z,$,l("td",ee,[s(L,{modelValue:_.selectedOperator,"onUpdate:modelValue":t[1]||(t[1]=e=>_.selectedOperator=e),items:_.usersList,attach:"",label:"Сотрудник"},{"prepend-item":r(()=>[s(U,null,{default:r(()=>[s(S,{modelValue:_.searchUser,"onUpdate:modelValue":t[0]||(t[0]=e=>_.searchUser=e),placeholder:"Поиск по ФИО",onInput:m.searchCrm},null,8,["modelValue","onInput"])]),_:1}),s(T,{class:"mt-2"})]),selection:r(({item:e})=>[s(N,{"no-gutters":"",align:"center",justify:"space-between"},{default:r(()=>[i(a(e.value.LAST_NAME)+" "+a(e.value.NAME)+" "+a(e.value.SECOND_NAME)+" ",1),s(x),e.value.PERSONAL_CITY?(d(),v(h,{key:0,class:"ml-1 mr-1","text-color":"white",color:"blue"},{default:r(()=>[i(a(e.value.PERSONAL_CITY),1)]),_:2},1024)):u("",!0),e.value.WORK_DEPARTMENT?(d(),v(h,{key:1,class:"mr-1","text-color":"white",color:"orange"},{default:r(()=>[i(a(e.value.WORK_DEPARTMENT),1)]),_:2},1024)):u("",!0)]),_:2},1024)]),item:r(({item:e,attrs:g,on:oe,active:le})=>[s(U,H(B(e),g,{default:"{ active }"}),{default:r(()=>[s(w,null,{default:r(()=>[s(k,{onClick:ae=>_.selectedOperator=e.value,ripple:""},{default:r(()=>[s(N,{"no-gutters":"",align:"center"},{default:r(()=>[l("span",null,a(e.value.LAST_NAME)+" "+a(e.value.NAME)+" "+a(e.value.SECOND_NAME),1),s(x),e.value.PERSONAL_CITY?(d(),v(h,{key:0,class:"mr-1","text-color":"white",color:"blue"},{default:r(()=>[i(a(e.value.PERSONAL_CITY),1)]),_:2},1024)):u("",!0),e.value.WORK_DEPARTMENT?(d(),v(h,{key:1,class:"mr-1","text-color":"white",color:"orange"},{default:r(()=>[i(a(e.value.WORK_DEPARTMENT),1)]),_:2},1024)):u("",!0),s(h,{"text-color":"white",color:e.value.UF_PHONE_INNER?"green":"red",small:""},{default:r(()=>[i(a(e.value.UF_PHONE_INNER?e.value.UF_PHONE_INNER:"Номер отсутствует"),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items"])]),_.selectedOperator?(d(),O("td",te,a(_.selectedOperator.UF_PHONE_INNER),1)):u("",!0),_.selectedOperator?(d(),O("td",re,[s(I,{onClick:m.saveOperator,"prepend-icon":"mdi-content-save-outline"},{default:r(()=>[i(" Добавить ")]),_:1},8,["onClick"])])):u("",!0)])])]),_:1})]),_:1}),s(E,{cols:"12"},{default:r(()=>[s(y,null,{default:r(()=>[s(N,null,{default:r(()=>[s(E,{cols:"10"}),s(E,{cols:"2"},{default:r(()=>[s(I,{onClick:m.deleteOperators,"prepend-icon":"mdi-delete-circle-outline"},{default:r(()=>[i(" Удалить ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const ce=P(j,[["render",se],["__scopeId","data-v-c3a515c0"]]);export{ce as default};
